<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:osuautodeafen"
        xmlns:cs="clr-namespace:osuautodeafen.cs"
        xmlns:avalonia1="clr-namespace:LiveChartsCore.SkiaSharpView.Avalonia;assembly=LiveChartsCore.SkiaSharpView.Avalonia"
        xmlns:settings="clr-namespace:osuautodeafen.cs.Settings"
        xmlns:global="clr-namespace:"
        xmlns:presets="clr-namespace:osuautodeafen.cs.Settings.Presets"
        xmlns:transitions="clr-namespace:Avalonia.Animation;assembly=Avalonia.Animation"
        xmlns:progressIndicator="clr-namespace:osuautodeafen.cs.StrainGraph.ProgressIndicator"
        mc:Ignorable="d" d:DesignWidth="150" d:DesignHeight="250"
        x:Class="osuautodeafen.MainWindow"
        Title="osuautodeafen"
        x:DataType="local:MainWindow">
    
  <Window.Resources>
        <global:AverageColorCycleConverter x:Key="AverageColorCycleConverter" />
        <presets:BackgroundPathToBrushConverter x:Key="BackgroundPathToBrushConverter" />
        <global:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <settings:ColorBlendConverter x:Key="ColorBlendConverter" />
        <settings:CheckBoxBackgroundConverter x:Key="CheckBoxBackgroundConverter" />
        <SolidColorBrush x:Key="BaseBackgroundBrush" Color="#171717" />
        <SolidColorBrush x:Key="SliderThumbBackground" Color="{Binding AverageColorBrushDim.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="SliderThumbBackgroundPointerOver" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="SliderThumbBackgroundPressed" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="SliderTrackValueFill" Color="{Binding AverageColorBrushDim.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="SliderTrackValueFillPointerOver" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="SliderTrackValueFillPressed" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />

        <SolidColorBrush x:Key="ButtonBackgroundBrush" Color="{Binding AverageColorBrushLight.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="ButtonBackgroundBrushPointerOver" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="ButtonBackgroundBrushPressed" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="ButtonBackgroundBrushDisabled" Color="{Binding AverageColorBrushDark.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="ButtonBorderBrush" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="ButtonForegroundBrush" Color="{Binding AverageColorBrushDim.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="ButtonHighlightBrush" Color="{Binding AverageColorBrush.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="CheckBoxBackgroundBrush" Color="{Binding AverageColorBrushLight.Color}"
                         x:DataType="cs:SharedViewModel" />
        <SolidColorBrush x:Key="TooltipColorBrush" Color="{Binding AverageColorBrushDimmer.Color}"
                         x:DataType="cs:SharedViewModel" />
    </Window.Resources>
    <Window.Styles>

        <Style Selector="Button">
            <Setter Property="Background" Value="{StaticResource ButtonBackgroundBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource ButtonBackgroundBrush}" />
        </Style>

        <Style Selector="CheckBox.custom">
            <Setter Property="Background" Value="{StaticResource CheckBoxBackgroundBrush}" />
        </Style>

        <Style Selector="Button.preset-list-item:pointerover">
            <Setter Property="BorderBrush" Value="#FFF" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="Background" Value="#22000000" />
        </Style>
        <Style Selector="Button.preset-list-item:pressed">
            <Setter Property="BorderBrush" Value="#FF66CCFF" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="Background" Value="#44000000" />
        </Style>
        <Style Selector="Button:disabled">
            <Setter Property="Background" Value="{StaticResource ButtonBackgroundBrushDisabled}" />
            <Setter Property="Foreground" Value="{StaticResource ButtonForegroundBrush}" />
        </Style>
        <Style Selector="CheckBox.custom">
            <Setter Property="Template">
                <ControlTemplate>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Width="18" Height="18"
                                CornerRadius="3"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                Margin="0,0,6,0"
                                VerticalAlignment="Center">
                            <Border.Background>
                                <MultiBinding Converter="{StaticResource CheckBoxBackgroundConverter}">
                                    <Binding Path="IsChecked" RelativeSource="{RelativeSource TemplatedParent}" />
                                    <Binding Path="Background" RelativeSource="{RelativeSource TemplatedParent}" />
                                </MultiBinding>
                            </Border.Background>
                            <Canvas Width="18" Height="18">
                                <Path
                                    Classes="custom-checkmark"
                                    Data="M4,9 L8,13 L14,5"
                                    Stroke="White"
                                    StrokeThickness="2"
                                    IsVisible="{TemplateBinding IsChecked}" />
                            </Canvas>
                        </Border>
                        <ContentPresenter Content="{TemplateBinding Content}"
                                          VerticalAlignment="Center"
                                          Foreground="White" />
                    </StackPanel>
                </ControlTemplate>
            </Setter>
            <Setter Property="Background" Value="{StaticResource ButtonBackgroundBrush}" />
        </Style>
        <Style Selector="CheckBox.custom Path.custom-checkmark:disabled">
            <Setter Property="Opacity" Value="0.3" />
        </Style>
        <Style Selector="CheckBox.custom:disabled">
            <Setter Property="Background" Value="#444" />
        </Style>
    </Window.Styles>
    
    <Grid ZIndex="5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="0" />
        </Grid.ColumnDefinitions>
        
        <ContentControl Content="{Binding CurrentPage}" x:DataType="cs:SharedViewModel"/>
        
        <Canvas ZIndex="99" IsHitTestVisible="False">
            <Grid x:Name="TooltipRoot"
                  ClipToBounds="True"
                  Opacity="0"
                  IsVisible="False"
                  Background="Transparent">

                <Border x:Name="TooltipBackground"
                        Background="{Binding Source={StaticResource TooltipColorBrush}}"
                        CornerRadius="8"
                        Opacity="0.8"
                        Padding="8">
                    <Border.Effect>
                        <BlurEffect Radius="1"/>
                    </Border.Effect>
                </Border>

                <TextBlock x:Name="TooltipText"
                           TextWrapping="Wrap"
                           Foreground="White"
                           FontSize="13"
                           FontWeight="Regular"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           TextAlignment="Center"/>
            </Grid>
        </Canvas>

        <Grid Grid.Column="0" HorizontalAlignment="Center" VerticalAlignment="Top">
            <StackPanel x:Name="LogoStackPanel" Margin="0,82,0,0">
                <StackPanel.RenderTransform>
                    <TransformGroup>
                        <TranslateTransform />
                        <ScaleTransform />
                    </TransformGroup>
                </StackPanel.RenderTransform>

                <StackPanel Orientation="Horizontal" x:Name="osuautodeafenLogoPanel">
                    <Image Name="osuLogo" Source="avares://osuautodeafen/Resources/osu_whitestroke.png" Height="60" />
                    <ContentControl Name="LogoHost" />
                </StackPanel>

              <!--  <TextBlock Text="{Binding CurrentAppVersion}" HorizontalAlignment="Center"
                           VerticalAlignment="Center" Margin="0,0,0,10" Foreground="White" FontSize="14"
                           x:Name="VersionPanel" x:DataType="cs:SharedViewModel"/> -->
            </StackPanel>
        </Grid>

        <!-- Main content -->
        <Grid Grid.Column="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel x:Name="DebugConsolePanel"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Margin="0,20,0,0"
                        IsVisible="False">
                <TextBlock x:Name="DebugConsoleTextBlock"
                           x:DataType="cs:SharedViewModel"
                           HorizontalAlignment="Stretch"
                           VerticalAlignment="Stretch"
                           Margin="0,20,0,0"
                           Padding="0"
                           FontFamily="Consolas"
                           Foreground="White"
                           IsVisible="False"
                           TextWrapping="Wrap"
                           IsHitTestVisible="True"
                           FontSize="6" />
            </StackPanel>
            <Border x:Name="SettingsButtonContainer" Grid.Column="1" Margin="0,42,0,0"
                    PointerEntered="SettingsButton_PointerEnter"
                    PointerExited="SettingsButton_PointerLeave">
                <Grid HorizontalAlignment="Right" VerticalAlignment="Top">

                    <Image Source="avares://osuautodeafen/Icons/outline.png"
                           Width="50" Height="50">
                        <Image.OpacityMask>
                            <MultiBinding Converter="{StaticResource ColorBlendConverter}"
                                          x:DataType="cs:SharedViewModel">
                                <Binding Path="Color" Source="{StaticResource BaseBackgroundBrush}" />
                                <Binding Path="AverageColorBrush.Color" />
                            </MultiBinding>
                        </Image.OpacityMask>
                    </Image>
                    <Button x:Name="SettingsButton"
                            Width="50" Height="50"
                            Background="{x:Null}"
                            BorderBrush="{x:Null}"
                            BorderThickness="0"
                            CornerRadius="0"
                            Click="SettingsButton_Click"
                            PointerEntered="SettingsButtonImage_PointerEnter"
                            PointerExited="SettingsButtonImage_PointerLeave"
                            IsVisible="True"
                            ZIndex="1">
                        <Svg x:Name="SettingsCogImage"
                             Path="Icons/gear.svg"
                             Width="50"
                             Height="50"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"
                             RenderTransformOrigin="0.5,0.5" />
                    </Button>
                </Grid>
            </Border>
        </Grid>
        
        <Grid x:Name="MainContainer" />


        <Grid VerticalAlignment="Bottom">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock Text="{Binding StatusMessage}" HorizontalAlignment="Center" VerticalAlignment="Top"
                       x:DataType="cs:SharedViewModel" Margin="0,0,0,0" Foreground="#ff3333" FontSize="14" />
            <Grid>
                <avalonia1:CartesianChart
                    x:Name="PlotView"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Height="120" />
                <progressIndicator:ProgressIndicatorOverlay
                    x:Name="ProgressOverlay"
                    IsHitTestVisible="False" />
                <Canvas x:Name="IconOverlay" IsHitTestVisible="False" x:DataType="cs:SharedViewModel" />
            </Grid>
            <Grid HorizontalAlignment="Stretch" x:Name="UpdateNotificationGrid" VerticalAlignment="Bottom"
                  Grid.Row="2" IsVisible="{Binding IsVisible, ElementName=UpdateNotificationBar}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Button x:Name="UpdateNotificationBar"
                        IsVisible="False"
                        HorizontalAlignment="Stretch"
                        FontSize="12"
                        Foreground="White"
                        x:DataType="cs:SharedViewModel"
                        Background="{Binding UpdateBarBackground}"
                        Click="UpdateNotificationBar_Click">
                    <Grid>
                        <ProgressBar x:Name="UpdateProgressBar"
                                     Minimum="0"
                                     Maximum="100"
                                     Value="{Binding UpdateProgress}"
                                     Foreground="Green"
                                     Background="Transparent"
                                     IsHitTestVisible="False"
                                     VerticalAlignment="Stretch"
                                     HorizontalAlignment="Stretch" />
                        <TextBlock Text="A new update is available!"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Margin="0" />
                    </Grid>
                </Button>
            </Grid>
        </Grid>
    </Grid>
</Window>